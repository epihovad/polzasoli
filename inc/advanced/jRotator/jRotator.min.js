jQuery.fn.jRotator=function(c){function k(c,n){if(2>d)return!1;l=!1;clearInterval(t);p.stop().width(0);var b=g.find("div:visible"),a=b.index();n?n--:n=c?a+1<d?a+1:0:0>a-1?d-1:a-1;g.find("div").hide();var f=g.find("div").eq(n);e.find("div").removeClass("cur");e.find("div").eq(n).addClass("cur");"none"==f.css("background-image")?(a=new Image,a.onload=function(){f.css("background-image","url("+f.attr("bg")+")");b.fadeOut("slow");f.fadeIn("slow","",function(){l=!0;p.animate({width:h},m,"linear");t=setInterval(function(){k(1)}, m)})},$(a).attr("src",f.attr("bg"))):(b.fadeOut("slow"),f.fadeIn("slow","",function(){l=!0;p.animate({width:h},m,"linear");t=setInterval(function(){k(1)},m)}))}c=$.extend({pAlign:"center",thumbW:"120",thumbH:"64",nothumb:!1,timeLineColor:"#ff0000"},c);var q=$(this),b=q.find("img"),d=b.size();if(!d)return!1;var l=!0,t;b.hide();var u=$('<div class="jR"></div>'),g=$('<div class="jR-images"></div>'),p=$('<div class="jR-timeline"></div>');if(!c.nothumb)var f=$('<div class="jR-thumbs"></div>');b.each(function(){var a= $(this).attr("src"),b=$(this).attr("thumb"),b=b?b:a,d="",e=$(this).parents(":first");e.is("a")&&(d=e.attr("href"));g.append('<div bg="'+a+'" href="'+d+'"></div>');c.nothumb||f.append('<img src="'+b+'" width="'+c.thumbW+'" height="'+c.thumbH+'">')});var r=$('<div class="jR-prev"></div>'),s=$('<div class="jR-next"></div>'),b=d,e=$('<div class="jR-points">'+Array(++b).join("<div></div>")+"</div>");u.prepend(g);1<d&&u.prepend(e).prepend(c.nothumb?"":f).prepend(r).prepend(s).prepend(p.css("background-color", c.timeLineColor));var m=7E3,h=q.width(),b=q.height(),a;e.find("div").each(function(a,b){var d=25*a;$(b).css("margin-left",d);c.nothumb||f.find("img").eq(a).css("margin-left",d)});u.add(g).add(g.find("div")).css({width:h,height:b});switch(c.pAlign){case "left":a=18;break;case "center":a=h/2-(18*d+7*(d-1))/2;break;case "right":a=h-(18*d+7*(d-1))-18}e.css({margin:b+38-18+"px 0 0 "+a+"px",width:"auto"});r.css("margin",b/2-18.5+"px 0 0 25px");s.css("margin",b/2-18.5+"px 0 0 "+(h-35-25)+"px");if(!c.nothumb){var v; switch(c.pAlign){case "left":v=1.5*a;break;case "center":v=a-c.thumbW/2;break;case "right":v=a-c.thumbW}f.css("margin",parseInt(e.css("margin-top").replace("px",""))+18+10+"px 0 0 "+v+"px")}var w=g.find(":first");a=new Image;a.onload=function(){w.css("background-image","url("+w.attr("bg")+")");w.fadeIn("slow","",function(){e.find(":first").addClass("cur");l=!0;1<d&&(p.animate({width:h},m,"linear"),t=setInterval(function(){k(1)},m))})};$(a).attr("src",w.attr("bg"));q.prepend(u);g.find("div").click(function(){var a= $(this).attr("href");if(!a)return!1;location.href=a});q.hover(function(){r.add(s).show()},function(){r.add(s).hide()});e.find("div").click(function(){if($(this).hasClass("cur"))return!1;e.find("div").removeClass("cur");$(this).addClass("cur");k(0,$(this).index()+1)});c.nothumb||e.find("div").hover(function(){f.find("img").eq($(this).index()).fadeIn(200)},function(){f.find("img").hide()});r.click(function(){l&&k();return!1});s.click(function(){l&&k(1);return!1})};
(function(c){var a={objs:"",o:"",box:"",im:"",bshadow:"",prev:"",next:"",info:"",mark:"",shadow:"",loader:""},b={path:"/inc/advanced/jImbox/",GLimages:[],GLwidth:[],GLheight:[],prmInit:[],imkol:1,num:0,index:0,visible:!1,ie:c.browser.msie&&"9.0">c.browser.version,W:0,H:0,L:0,T:0,startW:0,startH:0,startL:0,startT:0,imW:0,imH:0},f={init:function(d){d=c.extend({z:1E3,ws:!0,ws_params:{opacity:50,z:998}},d);b.prmInit=d;if(a.box)return c(this).each(function(){var e=this,d=!1;a.objs.each(function(){if(this== e)return d=!0,!1});d||c(e).attr("num",b.num++).click(function(){a.o=c(this);b.index=a.o.attr("num");f.run.call();return!1})}),!1;a.objs=c(this);a.objs.each(function(){c(this).attr("num",b.num++)});b.imkol=a.objs.size();a.box=c('<div id="jImbox" align="center"></div>');a.im=c('<img id="jImbox_im" alt="">');a.bshadow=c('<div id="jImbox_bshadow"></div>');a.prev=c('<a id="jImbox_prev" class="inline" href=""></a>');a.next=c('<a id="jImbox_next" class="inline" href=""></a>');a.info=c('<div id="jImbox_info"><div></div></div>'); a.mark=c('<div id="jImbox_mark"></div>');a.loader=c('<div id="jImbox_loader"><img src="'+b.path+'img/loader.gif" alt=""></div>');d=c('<div id="jImbox_btns" align="left"></div>');d.append(a.prev).append(a.next);a.box.prepend(a.im).prepend(a.info).prepend(a.mark).prepend(d).prepend(a.loader);c("body").prepend(a.box);a.objs.click(function(){a.o=c(this);b.index=a.o.attr("num");f.run.call();return!1});c(document).add("body, #jImbox, #jImbox *").bind("keyup",function(c){if(!b.visible)return!1;37==c.keyCode&& a.prev.click();39==c.keyCode&&a.next.click();27==c.keyCode&&f.hide.call()});a.im.click(function(){f.hide.call()});c(document).click(function(b){a.box.is(":visible")&&(c(b.target).parents("#jImbox").size()||f.hide.call())});c(window).resize(function(){f.repos.call()});c(document).mousewheel(function(b){a.im.is(":visible")&&b.preventDefault()})},run:function(){"undefined"!=typeof zmax&&(b.prmInit.z=zmax+3,b.prmInit.ws_params.z=b.prmInit.z-2,zmax+=3);var c=a.o.find(":first"),e=c.offset();b.startW=c.width(); b.startH=c.height();b.startL=e.left;b.startT=e.top;a.box.css({width:b.startW,height:b.startH,left:b.startL,top:b.startT,"z-index":b.prmInit.z});b.ie&&a.bshadow.css({"z-index":b.prmInit.z-1});f.setGL.call()},setGL:function(){function d(){var a=c("body").width()-50,d=c("body").height()-50,a=getMinRatioSize([b.GLwidth[b.index],b.GLheight[b.index]],[a,d-40]);b.imW=a.w;b.W=a.w;b.imH=a.h;b.H=a.h+40;b.L=Math.round(c("body").width()/2-b.W/2+c(window).scrollLeft());b.T=Math.round(c("body").height()/2-b.H/ 2+c(window).scrollTop());f.show.call({resize:e})}var e="undefined"!=typeof this.resize?this.resize:!1;if(b.GLimages[b.index])return d(),!1;var g=new Image;g.onload=function(){var c=a.o.attr("href"),e=g.width,f=g.height;c&&e&&f&&(b.GLimages[b.index]=c,b.GLwidth[b.index]=e,b.GLheight[b.index]=f,d())};c(g).attr("src",a.o.attr("href"))},show:function(){function d(){a.loader.css({left:Math.round(b.W/2-15.5),top:Math.round(b.H/2-15.5)}).show();var d=new Image;d.onload=function(){a.im.width(b.imW).height(b.imH).attr("src", b.GLimages[b.index]);a.loader.hide();a.info.show();""!=a.mark.html()&&a.mark.show();a.im.fadeIn("slow",function(){f.btn.call({flag:!0})})};c(d).attr("src",b.GLimages[b.index])}var e=b.prmInit;if("undefined"!=typeof this.resize&&this.resize){b.ie&&a.bshadow.hide();var e=a.o.find(":first"),g=e.offset();b.startW=e.width();b.startH=e.height();b.startL=g.left;b.startT=g.top}else b.visible=!0,a.box.show(),e.ws&&(a.shadow=c(document).jB("show",e.ws_params));(function(){var b=a.o.next("div.jImbox").html(); a.info.find("div").html(b);b=a.o.attr("mark");a.mark.html(b)})();b.W<a.info.width()?(b.W=a.info.width(),b.L=Math.round(c("body").width()/2-b.W/2+c(window).scrollLeft()),a.im.removeClass("rad")):(a.info.width(b.W),a.im.addClass("rad"));a.mark.css({"margin-top":b.H-a.mark.height(),"margin-left":b.W/2-a.mark.width()/2});a.box.animate({width:b.W,height:b.H,left:b.L,top:b.T},300,function(){d();b.ie&&a.bshadow.css({width:b.W,height:b.H,left:b.L-7,top:b.T-7}).show()})},repos:function(){if(!a.box.size()|| !a.box.is(":visible"))return!1;var d=Math.round(c("body").width()/2-a.box.width()/2+c(window).scrollLeft()),e=Math.round(c("body").height()/2-a.box.height()/2+c(window).scrollTop());a.box.css({left:d,top:e});b.ie&&a.bshadow.css({left:boxposLeft-7,top:boxposTop-7})},btn:function(){if(this.flag){var d=a.o.attr("gr"),d="undefined"==typeof d?"":d,e=0,g=0,h=[];a.objs.each(function(){if(c(this).attr("gr")!=d)return!0;h[e]=c(this);this==a.o[0]&&(g=e);e++});if(1==b.imkol||!d||2>e)return!1;var k=Math.round(b.H/ 2-a.prev.height()/2),l=Math.round(b.W-a.prev.width());a.prev.css("margin",k+"px 0 0 0");a.next.css("margin",k+"px 0 0 "+l+"px");var m=h[g-1],n=h[g+1];0==g?a.prev.addClass("na").unbind("click").bind("click",function(){return!1}):a.prev.removeClass("na").bind("click",function(){c(this).hide();f.imslide.call({obj:m});return!1});g==h.length-1?a.next.addClass("na").unbind("click").bind("click",function(){return!1}):a.next.removeClass("na").bind("click",function(){c(this).hide();f.imslide.call({obj:n}); return!1});a.prev.add(a.next).show();a.box.mouseover(function(){a.prev.add(a.next).show()});a.box.mouseout(function(){a.prev.add(a.next).hide()})}else a.prev.add(a.next).hide().removeClass("na").unbind("click").bind("click",function(){return!1}),a.box.unbind("mouseover").unbind("mouseout")},imslide:function(){f.btn.call({flag:!1});a.info.width("auto").hide();a.mark.hide();a.im.hide();a.o=this.obj;b.index=a.o.attr("num");f.setGL.call({resize:!0})},hide:function(){if(!a.box||!b.visible)return!1;b.ie&& a.bshadow.hide();f.btn.call({flag:!1});a.box.animate({width:b.startW,height:b.startH,left:b.startL,top:b.startT},300,function(){c(this).hide();a.im.hide();a.shadow.jB("hide");a.info.width("auto").hide();a.mark.hide();b.visible=!1})}};c.fn.jImbox=function(a){if(f[a])return f[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return f.init.apply(this,arguments)}})(jQuery);$(function(){$("a.jImbox").jImbox()});